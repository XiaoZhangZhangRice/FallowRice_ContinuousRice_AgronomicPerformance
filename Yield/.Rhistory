scale_x_continuous(name=expression("N Rate (kg N ha"^{-1}*")"), limits = c(-5, 290), breaks = c(0, 115, 155, 185, 225, 260))+ #limits = c(0,
scale_y_continuous(name= expression("Yield (Mg ha"^{-1}*")"), limits = c(0, 20), breaks = seq(0, 20, by = 2.5))+ #, limits = c(0, 16000), expand = c(0, 0), breaks =
#geom_errorbar(data=yield_average_dataframe, aes(ymin=Yield_Mgha-Yield_Mgha_se, ymax=Yield_Mgha+Yield_Mgha_se), width=8, size=0.7)+
theme_classic()+
theme(axis.text = element_text(size = 10), axis.title = element_text(size=10))+
geom_smooth(data = yield_average, method = "lm", formula = y ~ poly(x, 2), se = FALSE)+
#geom_vline(xintercept = c(0, 115, 155, 185, 225, 260), linetype = "twodash", color = "black") +
theme(legend.text = element_text(size = 10),legend.title = element_text(size = 14))+
stat_regline_equation(data=yield_average,
aes(x=Nrate, y=Yield_Mgha, color=Treatment, group = Treatment,
label = paste(..rr.label..)),
formula = y ~ poly(x, 2, raw = TRUE),
show.legend = FALSE, label.x = 0, label.y = c(16.5, 19))+
stat_regline_equation(data=yield_average,
aes(x=Nrate, y=Yield_Mgha, color=Treatment, group = Treatment,
label = paste(..eq.label..)),
formula = y ~ poly(x, 2, raw = TRUE),
show.legend = FALSE, label.x = 0, label.y = c(17.5, 20))+
theme(plot.title = element_text(hjust = 0.5, size = 15))+
ggtitle(expression("average"))+
annotate(
"text",
x = c(0),
y = yield_average_dataframe %>%
filter(Treatment == "FR", Nrate == 0) %>%
mutate(Yield_Mgha_plus_higher = Yield_Mgha + 1) %>%
pull(Yield_Mgha_plus_higher),
label = "*",
size = 7,
vjust = 0
)+
geom_vline(
aes(xintercept = optimal_results %>% filter(Treatment == "CR") %>% filter(Year == "average") %>% pull(Nrate_optimal)),
linetype = "twodash", color = "#0072B2", size = 1
)+
geom_vline(
aes(xintercept = optimal_results %>% filter(Treatment == "FR") %>% filter(Year == "average") %>% pull(Nrate_optimal)),
linetype = "twodash", color = "#FF9900", size = 1
)+
geom_curve(x = top_yields_average %>%
filter(Treatment == "FR") %>%
mutate(NrateF = as.numeric(paste(NrateF))) %>%
pull(NrateF),
y = top_yields_average %>%
filter(Treatment == "FR") %>%
pull(emmean)+0.2,
xend = top_yields_average %>%
filter(Treatment == "CR") %>%
mutate(NrateF = as.numeric(paste(NrateF))) %>%
pull(NrateF),
yend = top_yields_average %>%
filter(Treatment == "CR") %>%
pull(emmean)+0.2,
color = 1, size=1,
curvature = -0.2,
linetype = "twodash")+
annotate(
"text",
x =   (top_yields_average %>%
filter(Treatment == "FR") %>%
mutate(NrateF = as.numeric(paste(NrateF))) %>%
pull(NrateF)+
top_yields_average %>%
filter(Treatment == "CR") %>%
mutate(NrateF = as.numeric(paste(NrateF))) %>%
pull(NrateF))/2,
y = mean(top_yields_average %>%
filter(Treatment == "FR") %>%
pull(emmean),
top_yields_average %>%
filter(Treatment == "CR") %>%
pull(emmean)),
label = "ns",
size = 5,
vjust = -0.9,
hjust = 0.6)
N_response_curve_average_v1
N_response_curve_average <-
ggplot(yield_average, aes(x=Nrate, y=Yield_Mgha, color=Treatment, shape=Year))+
geom_point(data=yield_average, size=2)+ #this is the mean values+
geom_segment(x = -10,
y = yield_average_dataframe %>%
filter(Nrate==0)  %>%
filter(Treatment == "FR") %>%
pull(Yield_Mgha),
xend = 10,
yend = yield_average_dataframe %>%
filter(Nrate==0)  %>%
filter(Treatment == "FR") %>%
pull(Yield_Mgha),
color = "#FF9900", size=2)+
geom_segment(x = -10,
y = yield_average_dataframe %>%
filter(Nrate==0)  %>%
filter(Treatment == "CR") %>%
pull(Yield_Mgha),
xend = 10,
yend = yield_average_dataframe %>%
filter(Nrate==0)  %>%
filter(Treatment == "CR") %>%
pull(Yield_Mgha),
color = "#0072B2", size=2)+
#geom_point(data=yield_average, size=1, alpha=0.4)+ #this are the raw values
scale_color_manual(values=c("#0072B2","#FF9900"), name = "Treatment", labels = c('Continuous Rice (CR)','Fallow Rice (FR)'))+
scale_x_continuous(name=expression("N Rate (kg N ha"^{-1}*")"), limits = c(-20, 280), breaks = c(0, 115, 155, 185, 225, 260), expand =c(0,0))+ #limits = c(0,
scale_y_continuous(name= expression("Yield (Mg ha"^{-1}*")"), limits = c(0, 22), breaks = seq(0, 22, by = 2.5), expand =c(0,0))+
theme_classic()+
#geom_smooth(data = yield_average, aes(group = Treatment), method = "lm", formula = y ~ poly(x, 2), se = FALSE)+
#geom_vline(xintercept = c(0, 115, 155, 185, 225, 260), linetype = "twodash", color = "black") +
#stat_regline_equation(data=yield_average,
#                   aes(x=Nrate, y=Yield_Mgha, color=Treatment, group = Treatment,
#                      label = paste(..rr.label..)),
#                 formula = y ~ poly(x, 2, raw = TRUE),
#                show.legend = FALSE, label.x = 0, label.y = c(16.5, 19))+
#stat_regline_equation(data=yield_average,
#                  aes(x=Nrate, y=Yield_Mgha, color=Treatment, group = Treatment,
#                     label = paste(..eq.label..)),
#                formula = y ~ poly(x, 2, raw = TRUE),
#               show.legend = FALSE, label.x = 0, label.y = c(17.5, 20))+
theme(axis.text = element_text(size = 14), axis.title = element_text(size=16))+
theme(legend.text = element_text(size = 12),legend.title = element_text(size = 14))+
theme(plot.title = element_text(hjust = 0.5, size = 20, face = "bold"))+
ggtitle(expression("Yield: All"))+
annotate(
"text",
x = c(0),
y = yield_average_dataframe %>%
filter(Treatment == "FR", Nrate == 0) %>%
mutate(Yield_Mgha_plus_higher = Yield_Mgha + 2) %>%
pull(Yield_Mgha_plus_higher),
label = "*",
size = 7,
vjust = 0
)+
theme(legend.position = "bottom")
N_response_curve_average
Yields <- ggarrange(N_response_curve_2021,
N_response_curve_2022,
N_response_curve_2023,
#N_response_curve_average,
nrow = 1,
ncol = 3,
common.legend = TRUE,
#legend.grob = get_legend(N_response_curve_average),
legend= "bottom")
Yields
ggsave(filename = "Yields_no_avg.jpg",  # Include the file extension here
plot = Yields,              # Specify the plot
path = "C:/Users/zhang/Documents/GitHub/FallowRice_ContinuousRice_AgronomicPerformance/Figures",
dpi = 400,
height = 20, width = 50, units = "cm")
ggsave(filename = "2022_NResponse.jpg",  # Include the file extension here
plot = N_response_curve_2022,              # Specify the plot
path = "C:/Users/zhang/Documents/GitHub/FallowRice_ContinuousRice_AgronomicPerformance/Figures",
dpi = 400,
height = 15, width = 15, units = "cm")
all_means <- rbind(as.data.frame(field_means_2021) %>% mutate(Year = 2021),
as.data.frame(field_means_2022) %>% mutate(Year = 2022),
as.data.frame(field_means_2023) %>% mutate(Year = 2023),
as.data.frame(field_means_average) %>% mutate(Year = "Avg")
) %>% arrange(Year) %>% filter(NrateF == "0") %>%
mutate(yield = round(emmean, 1))
write_xlsx(all_means, "C:/Users/zhang/Documents/GitHub/FallowRice_ContinuousRice_AgronomicPerformance/Yield/Yield_by_year_0N.xlsx")
zero_N <- yield_average %>% filter(Nrate == 0)
model_zero <- lmer(Yield_Mgha ~ Treatment*Year+(1|Blk), data=zero_N)
zero_means_average = emmeans(model_zero,spec = 'Treatment', by = "Year")
zero_effects_average = contrast(zero_means_average, method = 'pairwise', adjust = "Tukey")
summary(zero_effects_average)
N_response_curve_graphical_abstract <-
ggplot(yield_2022_dataframe, aes(x=Nrate, y=Yield_Mgha, color=Treatment))+
geom_point(data=yield_2022_dataframe %>% filter(Treatment == "FR"),
aes(x=Nrate, y=Yield_Mgha, color="FR"), size=2.5) +
geom_point(data=yield_2022_dataframe %>% filter(Treatment == "CR"),
aes(x=Nrate, y=Yield_Mgha, color="CR"), size=2.5) +
#geom_point(data=yield_2022_dataframe, size=2.5, shape ="triangle")+ #this is the mean values
#geom_point(data=yield_2022, size=1, alpha=0.4, shape ="triangle")+ #this are the raw values
scale_color_manual(values=c("#0072B2","#FF9900"), name = "Treatment", labels = c('Continuous Rice (CR)','Fallow Rice (FR)'))+
scale_x_continuous(name=expression("N rate (kg N ha"^{-1}*")"), limits = c(-20, 280), breaks = seq(0, 300, by=50), expand =c(0,0))+ #limits = c(0,
scale_y_continuous(name= expression("Yield (Mg ha"^{-1}*")"), limits = c(0, 22), breaks = seq(0, 22, by = 2.5), expand =c(0,0))+
#geom_errorbar(data=yield_2022_dataframe, aes(ymin=Yield_Mgha-Yield_Mgha_se, ymax=Yield_Mgha+Yield_Mgha_se), width=8, size=0.7)+
theme_classic()+
geom_smooth(data = yield_2022, method = "lm", formula = y ~ poly(x, 2), se = FALSE)+
#geom_vline(xintercept = c(0, 115, 155, 185, 225, 260), linetype = "twodash", color = "black") +
theme(axis.text = element_text(size = 14), axis.title = element_text(size=16))+
theme(legend.text = element_text(size = 12),legend.title = element_text(size = 14))+
theme(plot.title = element_text(hjust = 0.5, size = 20, face = "bold"))+
theme(legend.position = "bottom")+
#ggtitle(expression("Yield: 2022"))+
annotate(
"text",
x = c(0),
y = yield_2022_dataframe %>%
filter(Treatment == "FR", Nrate == 0) %>%
mutate(Yield_Mgha_plus_higher = Yield_Mgha + 1) %>%
pull(Yield_Mgha_plus_higher),
label = "*",
size = 7,
vjust = 0
)+
geom_segment(
aes(x = optimal_results %>% filter(Treatment == "CR", Year == "2022") %>% pull(Nrate_optimal),
xend = optimal_results %>% filter(Treatment == "CR", Year == "2022") %>% pull(Nrate_optimal),
y = 0,  # Start exactly from 0 on y-axis
yend = optimal_results %>% filter(Treatment == "CR", Year == "2022") %>% pull(Yield_max)),
linetype = "twodash", color = "#0072B2", size = 0.6
) +
# Vertical line for FR
geom_segment(
aes(x = optimal_results %>% filter(Treatment == "FR", Year == "2022") %>% pull(Nrate_optimal),
xend = optimal_results %>% filter(Treatment == "FR", Year == "2022") %>% pull(Nrate_optimal),
y = 0,  # Start exactly from 0 on y-axis
yend = optimal_results %>% filter(Treatment == "FR", Year == "2022") %>% pull(Yield_max)),
linetype = "twodash", color = "#FF9900", size = 0.6
) +
# Horizontal line for CR
geom_segment(
aes(y = optimal_results %>% filter(Treatment == "CR", Year == "2022") %>% pull(Yield_max),
yend = optimal_results %>% filter(Treatment == "CR", Year == "2022") %>% pull(Yield_max),
x = -20,  # Start exactly from 0 on x-axis
xend = optimal_results %>% filter(Treatment == "CR", Year == "2022") %>% pull(Nrate_optimal)),
linetype = "twodash", color = "#0072B2", size = 0.6
) +
# Horizontal line for FR
geom_segment(
aes(y = optimal_results %>% filter(Treatment == "FR", Year == "2022") %>% pull(Yield_max),
yend = optimal_results %>% filter(Treatment == "FR", Year == "2022") %>% pull(Yield_max),
x = -20,  # Start exactly from 0 on x-axis
xend = optimal_results %>% filter(Treatment == "FR", Year == "2022") %>% pull(Nrate_optimal)),
linetype = "twodash", color = "#FF9900", size = 0.6
)+
geom_curve(x = top_yields_2022 %>%
filter(Treatment == "FR") %>%
mutate(NrateF = as.numeric(paste(NrateF))) %>%
pull(NrateF),
y = top_yields_2022 %>%
filter(Treatment == "FR") %>%
pull(emmean),
xend = top_yields_2022 %>%
filter(Treatment == "CR") %>%
mutate(NrateF = as.numeric(paste(NrateF))) %>%
pull(NrateF),
yend = top_yields_2022 %>%
filter(Treatment == "CR") %>%
pull(emmean),
color = 1, size=1,
curvature = -0.2)+
annotate(
"text",
x =   (top_yields_2022 %>%
filter(Treatment == "FR") %>%
mutate(NrateF = as.numeric(paste(NrateF))) %>%
pull(NrateF)+
top_yields_2022 %>%
filter(Treatment == "CR") %>%
mutate(NrateF = as.numeric(paste(NrateF))) %>%
pull(NrateF))/2,
y = mean(top_yields_2022 %>%
filter(Treatment == "FR") %>%
pull(emmean),
top_yields_2022 %>%
filter(Treatment == "CR") %>%
pull(emmean)),
label = "ns",
size = 5,
vjust = -2,
hjust = 0.1 )+
theme(axis.text.y=element_blank(),
axis.ticks.y=element_blank(),
axis.text.x=element_blank(),
axis.ticks.x=element_blank()
)+
theme(legend.title=element_blank())
N_response_curve_graphical_abstract
ggsave(filename = "N_response_curve_graphical_abstract.jpg",  # Include the file extension here
plot = N_response_curve_graphical_abstract,              # Specify the plot
path = "C:/Users/zhang/Documents/GitHub/FallowRice_ContinuousRice_AgronomicPerformance/Figures",
dpi = 800,
height = 10, width = 10.5, units = "cm")
library(ggplot2)
theme_set(theme_bw())
library(emmeans)
library(multcomp)
library(PLS205)
library(lme4)
library(lmerTest)
library(multcompView)
library(car)
library(Rmisc)
library(dplyr) #https://r4ds.had.co.nz/ (Chapter 3, Chapter 5, look at filter and select)
library(stringr)
library(readxl)
library(writexl)
library(ggpubr)
#read data
master = read_excel('C:/Users/zhang/Documents/GitHub/FallowRice_ContinuousRice_AgronomicPerformance/N uptake/N uptake calculations from SIF data/N_uptake_Maturity_Summed_Clean.xlsx', sheet = 1)
master$NrateF <- as.factor(master$Nrate_kgha)
Nrate_trial <- master %>%
#filter(Year != 2023) %>%
filter(Topdress!=1) %>%
filter(Stage=="Maturity") %>%
mutate(Year= as.factor(Year))
Nrate_trial_2021 <- master %>%
filter(Year == 2021) %>%
filter(Topdress!=1) %>%
filter(Stage=="Maturity") %>%
mutate(Year= as.factor(Year))
Nrate_trial_2022 <- master %>%
filter(Year == 2022) %>%
filter(Topdress!=1) %>%
filter(Stage=="Maturity") %>%
mutate(Year= as.factor(Year))
Nrate_trial_2023 <- master %>%
filter(Year == 2023) %>%
filter(Topdress!=1) %>%
filter(Stage=="Maturity") %>%
mutate(Year= as.factor(Year))
table(Nrate_trial_2021$Nrate_kgha)
model_2021 <- lmer(N_total_kgha ~ NrateF*Treatment+(1|Treatment:Blk)+(1:Blk), data=Nrate_trial_2021)
anova(model_2021)
field_means_2021 = emmeans(model_2021,spec = 'Treatment',by = 'NrateF')
field_effects_2021 = contrast(field_means_2021, method = 'pairwise', adjust = "Tukey")
summary(field_effects_2021)
cld(field_means_2021)
cld(emmeans(model_2021, ~ Treatment + NrateF),adjust = "Sidak")
cld_2021 <- cld(emmeans(model_2021, ~ Treatment + NrateF),adjust = "Sidak")
Nrate_trial_2021_dataframe <- Nrate_trial_2021 %>%
group_by(Treatment, Nrate_kgha) %>%
mutate(N_total_kgha_se = sd(N_total_kgha)/sqrt(3)) %>%
summarise(N_total_kgha = mean(N_total_kgha),
N_total_kgha_se = mean(N_total_kgha_se))
Nuptake_graph_2021 <-
ggplot(Nrate_trial_2021, aes(x=Nrate_kgha, y=N_total_kgha, color=Treatment))+
geom_point(size=1, alpha=0.4)+
geom_point(data=Nrate_trial_2021_dataframe, size=2.5)+ #this is the mean values
scale_shape_manual(values = c("circle"))+
geom_smooth(aes(group = Treatment),method = lm, level = 0.95)+
scale_color_manual(values=c("#0072B2","#FF9900"), name = "Treatment", labels = c("Continuous Rice (CR)", "Fallow Rice (FR)"))+
scale_x_continuous(name=expression("N rate (kg N ha"^{-1}*")"), limits = c(-20, 320), breaks = seq(0, 300, by=50), expand =c(0,0))+
#scale_x_continuous(name=expression("N rate (kg N ha"^{-1}*")"), limits = c(-20, 320), expand = c(0, 0), breaks = c(0,115,155,185,225,260))+
scale_y_continuous(name=expression("N uptake (kg N ha"^{-1}*")"), limits = c(0, 300), expand = c(0, 0), breaks = seq(0, 300, by = 50))+
#geom_errorbar(aes(ymin=N_total_kgha-N_total_kgha_se, ymax=N_total_kgha+N_total_kgha_se), width=3,position=position_dodge(0.5))+
#geom_vline(xintercept = c(41, 50, 78, 84, 121, 136), linetype = "dashed", color = "black") +
theme_classic()+
stat_regline_equation(aes(x=Nrate_kgha, y=N_total_kgha,color=Treatment,group = Treatment,
label =  paste(..rr.label..)),
show.legend = FALSE,
label.x = 200,
label.y = c(60, 90))+
stat_regline_equation(aes(x=Nrate_kgha, y=N_total_kgha,color=Treatment,group = Treatment,
label = paste(..eq.label..)),
show.legend = FALSE,
label.x = 200,
label.y = c(70, 100))+
theme(axis.text = element_text(size = 14), axis.title = element_text(size=16))+
theme(legend.text = element_text(size = 12),legend.title = element_text(size = 14))+
theme(plot.title = element_text(hjust = 0.5, size = 20, face = "bold"))+
ggtitle(expression("N uptake"[maturity]~": 2021"))
#annotate(
#"text",
#x = c(0),
#y = Nrate_trial_2021_dataframe %>%
#      filter(Treatment == "FR", Nrate_kgha == 0) %>%
#      mutate(N_total_kgha_plus_higher = N_total_kgha + 25) %>%
#      pull(N_total_kgha_plus_higher),
#label = "*",
#size = 7,
#vjust = 0
#)
Nuptake_graph_2021
model_2022 <- lmer(N_total_kgha ~ NrateF*Treatment+(1|Treatment:Blk)+(1:Blk), data=Nrate_trial_2022)
anova(model_2022)
field_means_2022 = emmeans(model_2022,spec = 'Treatment',by = 'NrateF')
field_effects_2022 = contrast(field_means_2022, method = 'pairwise', adjust = "Tukey")
summary(field_effects_2022)
cld(field_means_2022)
cld(emmeans(model_2022, ~ Treatment + NrateF),adjust = "Sidak")
cld_2022 <- cld(emmeans(model_2022, ~ Treatment + NrateF),adjust = "Sidak")
Nrate_trial_2022_dataframe <- Nrate_trial_2022 %>%
group_by(Treatment, Nrate_kgha) %>%
mutate(N_total_kgha_se = sd(N_total_kgha)/sqrt(3)) %>%
summarise(N_total_kgha = mean(N_total_kgha),
N_total_kgha_se = mean(N_total_kgha_se))
Nuptake_graph_2022 <-
ggplot(Nrate_trial_2022, aes(x=Nrate_kgha, y=N_total_kgha, color=Treatment))+
geom_point(size=1, alpha=0.4, shape ="triangle")+
geom_point(data=Nrate_trial_2022_dataframe, size=2.5, shape ="triangle")+ #this is the mean values
#scale_shape_manual(values = c("triangle"))+
geom_smooth(aes(group = Treatment),method = lm, level = 0.95)+
scale_color_manual(values=c("#0072B2","#FF9900"), name = "Treatment", labels = c("Continuous Rice (CR)", "Fallow Rice (FR)"))+
scale_x_continuous(name=expression("N rate (kg N ha"^{-1}*")"), limits = c(-20, 320), breaks = seq(0, 300, by=50), expand =c(0,0))+
#scale_x_continuous(name=expression("N rate (kg N ha"^{-1}*")"), limits = c(-20, 320), expand = c(0, 0), breaks = c(0,115,155,185,225,260))+
scale_y_continuous(name=expression("N uptake (kg N ha"^{-1}*")"), limits = c(0, 300), expand = c(0, 0), breaks = seq(0, 300, by = 50))+
#geom_errorbar(aes(ymin=N_total_kgha-N_total_kgha_se, ymax=N_total_kgha+N_total_kgha_se), width=3,position=position_dodge(0.5))+
#geom_vline(xintercept = c(41, 50, 78, 84, 121, 136), linetype = "dashed", color = "black") +
theme_classic()+
stat_regline_equation(aes(x=Nrate_kgha, y=N_total_kgha,color=Treatment,group = Treatment,
label =  paste(..rr.label..)),
show.legend = FALSE,
label.x = 200,
label.y = c(60, 90))+
stat_regline_equation(aes(x=Nrate_kgha, y=N_total_kgha,color=Treatment,group = Treatment,
label = paste(..eq.label..)),
show.legend = FALSE,
label.x = 200,
label.y = c(70, 100))+
theme(axis.text = element_text(size = 14), axis.title = element_text(size=16))+
theme(legend.text = element_text(size = 12),legend.title = element_text(size = 14))+
theme(plot.title = element_text(hjust = 0.5, size = 20, face = "bold"))+
ggtitle(expression("N uptake"[maturity]~": 2022"))
Nuptake_graph_2022
model_2023 <- lmer(N_total_kgha ~ NrateF*Treatment+(1|Treatment:Blk)+(1:Blk), data=Nrate_trial_2023)
anova(model_2023)
field_means_2023 = emmeans(model_2023,spec = 'Treatment',by = 'NrateF')
field_effects_2023 = contrast(field_means_2023, method = 'pairwise', adjust = "Tukey")
summary(field_effects_2023)
cld(field_means_2023)
cld(emmeans(model_2023, ~ Treatment + NrateF),adjust = "Sidak")
cld_2023 <- cld(emmeans(model_2023, ~ Treatment + NrateF),adjust = "Sidak")
Nrate_trial_2023_dataframe <- Nrate_trial_2023 %>%
group_by(Treatment, Nrate_kgha) %>%
mutate(N_total_kgha_se = sd(N_total_kgha)/sqrt(3)) %>%
summarise(N_total_kgha = mean(N_total_kgha),
N_total_kgha_se = mean(N_total_kgha_se))
Nuptake_graph_2023 <-
ggplot(Nrate_trial_2023, aes(x=Nrate_kgha, y=N_total_kgha, color=Treatment))+
geom_point(size=1, alpha=0.4, shape ="square")+
geom_point(data=Nrate_trial_2023_dataframe, size=2.5, shape ="square")+ #this is the mean values
#scale_shape_manual(values = c("square"))+
geom_smooth(aes(group = Treatment),method = lm, level = 0.95)+
scale_color_manual(values=c("#0072B2","#FF9900"), name = "Treatment", labels = c("Continuous Rice (CR)", "Fallow Rice (FR)"))+
scale_x_continuous(name=expression("N rate (kg N ha"^{-1}*")"), limits = c(-20, 320), breaks = seq(0, 300, by=50), expand =c(0,0))+
#scale_x_continuous(name=expression("N rate (kg N ha"^{-1}*")"), limits = c(-20, 320), expand = c(0, 0), breaks = c(0, 90,120,150,180,210))+
scale_y_continuous(name=expression("N uptake (kg N ha"^{-1}*")"), limits = c(0, 300), expand = c(0, 0), breaks = seq(0, 300, by = 50))+
#geom_errorbar(aes(ymin=N_total_kgha-N_total_kgha_se, ymax=N_total_kgha+N_total_kgha_se), width=3,position=position_dodge(0.5))+
#geom_vline(xintercept = c(41, 50, 78, 84, 121, 136), linetype = "dashed", color = "black") +
theme_classic()+
stat_regline_equation(aes(x=Nrate_kgha, y=N_total_kgha,color=Treatment,group = Treatment,
label =  paste(..rr.label..)),
show.legend = FALSE,
label.x = 200,
label.y = c(60, 90))+
stat_regline_equation(aes(x=Nrate_kgha, y=N_total_kgha,color=Treatment,group = Treatment,
label = paste(..eq.label..)),
show.legend = FALSE,
label.x = 200,
label.y = c(70, 100))+
theme(axis.text = element_text(size = 14), axis.title = element_text(size=16))+
theme(legend.text = element_text(size = 12),legend.title = element_text(size = 14))+
theme(plot.title = element_text(hjust = 0.5, size = 20, face = "bold"))+
ggtitle(expression("N uptake"[maturity]~": 2023"))
Nuptake_graph_2023
model_all <- lmer(N_total_kgha ~ NrateF*Treatment+(1|Treatment:Blk)+(1:Blk), data=Nrate_trial)
anova(model_all)
field_means_all = emmeans(model_all,spec = 'Treatment',by = 'NrateF')
field_effects_all = contrast(field_means_all, method = 'pairwise', adjust = "Tukey")
summary(field_effects_all)
cld(field_means_all)
cld(emmeans(model_all, ~ Treatment + NrateF),adjust = "Sidak")
cld_all <- cld(emmeans(model_all, ~ Treatment + NrateF),adjust = "Sidak")
all_Nuptake_graph <-
ggplot(Nrate_trial, aes(x=Nrate_kgha, y=N_total_kgha, color=Treatment,shape=Year))+
geom_point(size=2.5)+
geom_smooth(aes(group = Treatment),method = lm, level = 0.95)+
scale_color_manual(values=c("#0072B2","#FF9900"), name = "Treatment", labels = c("Continuous rice (CR)", "Fallow rice (FR)"))+
scale_x_continuous(name=expression("N rate (kg N ha"^{-1}*")"), limits = c(-20, 320), expand = c(0, 0), breaks = seq(0, 300, by = 50))+
scale_y_continuous(name=expression("N uptake (kg N ha"^{-1}*")"), limits = c(0, 300), expand = c(0, 0), breaks = seq(0, 300, by = 50))+
#geom_errorbar(aes(ymin=N_total_kgha-N_total_kgha_se, ymax=N_total_kgha+N_total_kgha_se), width=3,position=position_dodge(0.5))+
#geom_vline(xintercept = c(41, 50, 78, 84, 121, 136), linetype = "dashed", color = "black") +
theme_classic()+
stat_regline_equation(aes(x=Nrate_kgha, y=N_total_kgha,color=Treatment,group = Treatment,
label =  paste(..rr.label..)),
show.legend = FALSE,
label.x = 200,
label.y = c(60, 90))+
stat_regline_equation(aes(x=Nrate_kgha, y=N_total_kgha,color=Treatment,group = Treatment,
label = paste(..eq.label..)),
show.legend = FALSE,
label.x = 200,
label.y = c(70, 100))+
theme(axis.text = element_text(size = 14), axis.title = element_text(size=16))+
theme(legend.text = element_text(size = 12),legend.title = element_text(size = 14))+
theme(plot.title = element_text(hjust = 0.5, size = 20, face = "bold"))+
ggtitle(expression("Total N uptake: All"))+
theme(legend.position = "bottom")
all_Nuptake_graph
N_uptake_maturity <- ggarrange(Nuptake_graph_2021 + theme(legend.position = "none"),
Nuptake_graph_2022 + theme(legend.position = "none"),
Nuptake_graph_2023 + theme(legend.position = "none"),
#all_Nuptake_graph,
nrow = 1,
ncol = 3,
common.legend = TRUE,
#legend.grob = get_legend(all_Nuptake_graph),
legend= "bottom")
ggsave(filename = "N_uptake_maturity.jpg",  # Include the file extension here
plot = N_uptake_maturity,              # Specify the plot
path = "C:/Users/zhang/Documents/GitHub/FallowRice_ContinuousRice_AgronomicPerformance/Figures",
dpi = 400,
height = 20, width = 50, units = "cm")
all_means <- rbind(as.data.frame(field_means_2021) %>% mutate(Year = 2021),
as.data.frame(field_means_2022) %>% mutate(Year = 2022),
as.data.frame(field_means_2023) %>% mutate(Year = 2023),
as.data.frame(field_means_all) %>% mutate(Year = "Avg")
) %>% arrange(Year) %>% filter(NrateF == "0") %>%
mutate(Nuptake = round(emmean, 1))
write_xlsx(all_means, "C:/Users/zhang/Documents/GitHub/FallowRice_ContinuousRice_AgronomicPerformance/N uptake/N_uptake_maturity/0N_Nuptake_By_Year.xlsx")
zero_N <- Nrate_trial %>% filter(Nrate_kgha == 0)
model_zero <- lmer(N_total_kgha ~ Treatment*Year+(1|Blk), data=zero_N)
anova(model_zero)
zero_means_average = emmeans(model_zero,spec = 'Treatment', by = "Year")
zero_effects_average = contrast(zero_means_average, method = 'pairwise', adjust = "Tukey")
summary(zero_effects_average)
